{"type":"cy:bean","properties":{"beanType@STRING":"cy:requiremodule","name@STRING":"CollectionInput","dependencies@STRING":["/libs/bndly/data/scripts/cy/ui/Text","/libs/bndly/data/scripts/cy/ui/input/InputTypeRegistry","/libs/bndly/data/scripts/cy/form/Forms","/libs/bndly/data/scripts/cy/ui/container/ViewContainer","/libs/bndly/data/scripts/cy/LabelFunctions","/libs/bndly/data/scripts/cy/Collection","/libs/bndly/data/scripts/cy/ui/input/Button","/libs/bndly/data/scripts/cy/ui/input/InputViewComponent"],"script@STRING":"var CollectionInput = InputViewComponent.extend({\r\n\tconstruct: function(config) {\r\n\t\tif (!config) {\r\n\t\t\tconfig = {};\r\n\t\t}\r\n\t\tconfig.addButton = new Button({\r\n\t\t\tlabel: \"add\",\r\n\t\t\tlisteners: {\r\n\t\t\t\tclicked: {\r\n\t\t\t\t\tfn: this.addNewEntry,\r\n\t\t\t\t\tscope: this\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tconfig.backButton = new Button({\r\n\t\t\tlabel: \"back\",\r\n\t\t\thidden: true,\r\n\t\t\tlisteners: {\r\n\t\t\t\tclicked: {\r\n\t\t\t\t\tfn: this.entryEdited,\r\n\t\t\t\t\tscope: this\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(!config.entryLabelFn) {\r\n\t\t\tconfig.entryLabelFn = function(entry){ \r\n\t\t\t\tvar label = LabelFunctions(entry); \r\n\t\t\t\tif(!label) {\r\n\t\t\t\t\tlabel = \"&nbsp;\";\r\n\t\t\t\t}\r\n\t\t\t\treturn label;\r\n\t\t\t};\r\n\t\t}\r\n\t\tif(!config.entryFactoryFn) {\r\n\t\t\tconsole.error(\"missing an entryFactoryFn for CollectionInput\");\r\n\t\t}\r\n\t\tif(!config.entryFormItemsBuilderFn) {\r\n\t\t\tconfig.entryFormItemsBuilderFn = function(entry, items) {\r\n\t\t\t\tvar FormBinder = InputTypeRegistry.getInputConstructor(\"FormBinder\");\r\n\t\t\t\tnew FormBinder({\r\n\t\t\t\t\tentity: entry,\r\n\t\t\t\t\tsections: Forms[entry.clazzName()]\r\n\t\t\t\t}).renderMembersToForm(entry, items, {});\r\n\t\t\t};\r\n\t\t}\r\n\t\tconfig.bulletBindings = [];\r\n\t\tthis.callSuper(arguments, config);\r\n\t\t\t\t\t\r\n\t\tvar val;\r\n\t\tif(this.member && this.entity) {\r\n\t\t\tval = this.getBoundValue();\r\n\t\t} else {\r\n\t\t\tif(!config.value) {\r\n\t\t\t\tval = new Collection();\r\n\t\t\t} else {\r\n\t\t\t\tval = config.value;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!val) {\r\n\t\t\tval = new Collection();\r\n\t\t\tthis.setBoundValue(val);\r\n\t\t}\r\n\t\tthis.value = val;\r\n\t\tthis.listen(val, \"inserted\", this.entryAdded, this);\r\n\t\tthis.listen(val, \"removed\", this.entryRemoved, this);\r\n\t},\r\n\tdestroy: function() {\r\n\t\targuments.callee.$parent.destroy.call(this);\r\n\t},\r\n\tbuildNewEntry: function(){\r\n\t\tif(this.entryFactoryFn) {\r\n\t\t\treturn this.entryFactoryFn(this.entity);\r\n\t\t}\r\n\t\treturn undefined;\r\n\t},\r\n\taddNewEntry: function(button) {\r\n\t\tthis.getValue().add(this.buildNewEntry());\r\n\t},\r\n\tentryRemoved: function(entry) {\r\n\t\tvar binding = this.getBulletBindingForEntry(entry);\r\n\t\tif(binding) {\r\n\t\t\t$(binding.bullet).remove();\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"could not find bullet binding for entry\");\r\n\t\t}\r\n\t\tif(this.value.isEmpty()) {\r\n\t\t\t$(this.wrapper).hide();\r\n\t\t}\r\n\t},\r\n\tentryAdded: function(entry) {\r\n\t\tthis.renderEntry(entry);\r\n\t},\r\n\tgetBulletBindingForEntry: function(entry) {\r\n\t\tfor(var i in this.bulletBindings) {\r\n\t\t\tif(this.bulletBindings[i].entry === entry) {\r\n\t\t\t\treturn this.bulletBindings[i];\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn undefined;\r\n\t},\r\n\trenderEntry: function(entry) {\r\n\t\tif(this.wrapper) {\r\n\t\t\t$(this.wrapper).show();\r\n\t\t\tvar itemBullet = $(this.wrapper).append(\"<li class=\\\"list-group-item\\\"></li>\").children().last();\r\n\t\t\tvar itemAnchor = $(itemBullet).append(\"<a href=\\\"#\\\"></a>\").children().last();\r\n\t\t\tvar itemLabel = new Text({value: this.entryLabelFn(entry)});\r\n\t\t\titemLabel.renderTo(itemAnchor);\r\n\t\t\tthis.listen(entry, \"changed\", function(changedEntry){\r\n\t\t\t\titemLabel.value.set(this.entryLabelFn(changedEntry));\r\n\t\t\t}, this);\r\n\t\t\tvar deleteButton = $(itemBullet).append(\"<span class=\\\"badge\\\"><span class=\\\"glyphicon glyphicon-remove\\\" aria-hidden=\\\"true\\\"></span></span>\").children().last();\r\n\t\t\tvar _this = this;\r\n\t\t\t$(itemAnchor).click(function(){\r\n\t\t\t\t_this.editEntry(entry);\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\t$(deleteButton).click(function(){\r\n\t\t\t\tvar index = _this.getValue().indexOf(entry);\r\n\t\t\t\t_this.getValue().removeAtIndex(index);\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\tthis.bulletBindings.push({\r\n\t\t\t\tbullet: itemBullet,\r\n\t\t\t\tanchor: itemAnchor,\r\n\t\t\t\tentry: entry\r\n\t\t\t});\r\n\t\t\t\r\n\t\t}\r\n\t},\r\n\teditEntry: function(entry) {\r\n\t\tvar items = [];\r\n\t\tthis.entryFormItemsBuilderFn(entry, items);\r\n\t\tthis.vc = new ViewContainer({\r\n\t\t\titems: items\r\n\t\t});\r\n\t\tthis.vc.renderTo(this.rightDiv);\r\n\t\tthis.slideListToLeft();\r\n\t},\r\n\tentryEdited: function(){\r\n\t\tthis.vc.destroy();\r\n\t\tthis.slideListToRight();\r\n\t},\r\n\tslideListToLeft: function(){\r\n\t\t$(this.slideWrapper).animate({\r\n\t\t\tleft: -($(this.slideWrapper).width()/2)\r\n\t\t});\r\n\t\tthis.backButton.show();\r\n\t},\r\n\tslideListToRight: function(){\r\n\t\tthis.backButton.hide();\r\n\t\t$(this.slideWrapper).animate({\r\n\t\t\tleft: 0\r\n\t\t});\r\n\t},\r\n\trenderTo: function(renderTarget) {\r\n\t\tthis.globalWrapper = $(renderTarget).append(\"<div></div>\").children().last();\r\n\t\t$(this.globalWrapper).css({\r\n\t\t\toverflow: \"hidden\"\r\n\t\t});\r\n\t\tthis.slideWrapper = $(this.globalWrapper).append(\"<div></div>\").children().last();\r\n\t\t$(this.slideWrapper).css({\r\n\t\t\tposition: \"relative\",\r\n\t\t\tleft: 0,\r\n\t\t\twidth: \"200%\"\r\n\t\t});\r\n\t\tthis.leftDiv = $(this.slideWrapper).append(\"<div class=\\\"js-collection-input-left\\\"></div>\").children().last();\r\n\t\tthis.wrapper = $(this.leftDiv).append(\"<ul class=\\\"list-group\\\">\").children().last();\r\n\t\t\r\n\t\tif(this.value.isEmpty()) {\r\n\t\t\t$(this.wrapper).hide();\r\n\t\t}\r\n\t\t$(this.leftDiv).css({\r\n\t\t\tfloat: \"left\",\r\n\t\t\twidth: \"50%\"\r\n\t\t});\r\n\t\tthis.rightDiv = $(this.slideWrapper).append(\"<div class=\\\"col-sm-12 js-collection-input-right\\\"></div>\").children().last();\r\n\t\t$(this.rightDiv).css({\r\n\t\t\twidth: \"50%\",\r\n\t\t\tfloat: \"left\"\r\n\t\t});\r\n\t\tthis.getValue().each(function(entry){\r\n\t\t\tthis.renderEntry(entry);\r\n\t\t}, this);\r\n\t\tthis.addButton.renderTo(this.leftDiv);\r\n\t\tthis.backButton.renderTo(this.globalWrapper);\r\n\t},\r\n\thide: function(){\r\n\t\tif(this.leftDiv) {\r\n\t\t\t$(this.leftDiv).hide();\r\n\t\t}\r\n\t\tthis.addButton.hide();\r\n\t},\r\n\tshow: function(){\r\n\t\tif(this.leftDiv) {\r\n\t\t\t$(this.leftDiv).show();\r\n\t\t}\r\n\t\tthis.addButton.show();\r\n\t},\r\n\tgetValue: function() {\r\n\t\treturn this.value;\r\n\t},\r\n\tsetValue: function(value) {\r\n\t\tthis.value = value;\r\n\t}\r\n});\r\nInputTypeRegistry.register(\"CollectionInput\", CollectionInput);\r\nreturn CollectionInput;","initMethod@STRING":"","proxy@STRING":"","moduleId@STRING":"","export@STRING":""}}
