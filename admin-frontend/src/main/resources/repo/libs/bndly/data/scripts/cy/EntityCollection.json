{"type":"cy:bean","properties":{"beanType@STRING":"cy:requiremodule","name@STRING":"EntityCollection","dependencies@STRING":["/libs/bndly/data/scripts/cy/Collection"],"script@STRING":"var EntityCollection = Collection.extend({\r\n\tconstruct: function(config) {\r\n\t\tif(!config) {\r\n\t\t\tconfig = {};\r\n\t\t}\r\n\t\tthis.callSuper(arguments, config);\r\n\t\t\t\t\tif(this.proto) {\r\n\t\t\t\t\t\tthis.listen(this.proto, \"foundSimilar\", this.loadPageItemsToCollection, this);\r\n\t\t\t\t\t}\r\n\t},\r\n\tload: function(){\r\n\t\tthis.proto.findAll();\r\n\t},\r\n\tloadPageItemsToCollection: function(proto, page, callback) {\r\n\t\t// load the next page\r\n\t\tvar next = page.hasLink(\"next\"),\r\n\t\thasMore = undefined;\r\n\t\tif (next) {\r\n\t\t\thasMore = true;\r\n\t\t\tpage.follow({\r\n\t\t\t\tlink: next,\r\n\t\t\t\tcb: function(nextPage) {\r\n\t\t\t\t\tthis.loadPageItemsToCollection(proto, nextPage);\r\n\t\t\t\t},\r\n\t\t\t\tscope: this\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\thasMore = false;\r\n\t\t}\r\n\r\n\t\t// render the already known attributes\r\n\t\tthis.addAll(page.getItems());\r\n\t\tif(!hasMore) {\r\n\t\t\tthis.fireEvent(\"allLoaded\", this);\r\n\t\t}\r\n\t},\r\n\t\t\tsetProto: function(proto){\r\n\t\t\t\tif(!proto) {\r\n\t\t\t\t\tthrow new Error(\"setting entity collection prototype illegal value\");\r\n\t\t\t\t}\r\n\t\t\t\tif(this.proto) {\r\n\t\t\t\t\tthis.proto.destroy();\r\n\t\t\t\t}\r\n\t\t\t\tthis.proto = proto;\r\n\t\t\t\tthis.listen(this.proto, \"foundSimilar\", this.loadPageItemsToCollection, this);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n});\r\nreturn EntityCollection;","initMethod@STRING":"","proxy@STRING":"","moduleId@STRING":""}}
