{"type":"cy:bean","properties":{"beanType@STRING":"cy:requiremodule","name@STRING":"RestBeans","script@STRING":"// data contains the description of the service.\n// now is the time to build the runtime types.\n// return data;\n\nvar\n\tcy = {},\n\tentry = serviceDescription.entry,\n\ttypes = serviceDescription.types,\n\ttypesByRootElement = {},\n\tupperCaseFirst = StringUtil.upperCaseFirst,\n\tschemaPromise,\n\tservices,\n\tisSimpleTypeName = function(memberType) {\n\t\treturn memberType === \"String\" || memberType === \"Number\" || memberType === \"Boolean\" || memberType === \"Date\"\n\t},\n\tgetSchemaPromise = function(){\n\t\tif(!schemaPromise) {\n\t\t\t// set up an initial loading of the available schemas\n\t\t\tschemaPromise = new Promise(function(resolve, reject){\n\t\t\t\tcy.initPromise.then(function(){\n\t\t\t\t\tcy.root.follow({ rel: \"schema\"})\n\t\t\t\t\t.then(function(schemaBeans){\n\t\t\t\t\t\t// schema information is loaded\n\t\t\t\t\t\tcy.schemas = {};\n\t\t\t\t\t\tschemaBeans.getItems().each(function(schema){\n\t\t\t\t\t\t\tcy.schemas[schema.getName()] = {};\n\t\t\t\t\t\t\tschema.getTypes().each(function(type){\n\t\t\t\t\t\t\t\tif(!type.getIsAbstract()) {\n\t\t\t\t\t\t\t\t\tvar link = type.hasLink(\"primaryResource\");\n\t\t\t\t\t\t\t\t\tif(link) {\n\t\t\t\t\t\t\t\t\t\tcy.schemas[schema.getName()][type.getName()] = {\n\t\t\t\t\t\t\t\t\t\t\trootLink: link,\n\t\t\t\t\t\t\t\t\t\t\ttype: type\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve(cy.schemas);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function(_error){\n\t\t\t\t\t\t// schema information could not be loaded\n\t\t\t\t\t\treject(_error);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn schemaPromise;\n\t},\n\tcreateGetter = function(_member) {\n\t\treturn function(_value, _silent) {\n\t\t\tvar v = this[_member];\n\t\t\treturn v;\n\t\t};\n\t},\n\tcreateSetter = function(_member, isComplexType, isCollection, classDef) {\n\t\tif (isComplexType && !isCollection) {\n\t\t\tclassDef[\"_\" + _member + \"Changed\"] = function(nestedEntity, nestedMember, nestedValue, nestedOldValue) {\n\t\t\t\tthis.fireEvent(\"changed\", this, _member + \".\" + nestedMember, nestedValue, nestedOldValue);\n\t\t\t};\n\t\t} else if (isComplexType && isCollection) {\n\t\t\tclassDef[\"_\" + _member + \"EntryInserted\"] = function(insertedEntry, index) {\n\t\t\t\tif (insertedEntry) {\n\t\t\t\t\tinsertedEntry.addListener(\"changed\", this[\"_\" + _member + \"EntryChanged\"], this);\n\t\t\t\t}\n\t\t\t};\n\t\t\tclassDef[\"_\" + _member + \"EntryRemoved\"] = function(removedEntry, index) {\n\t\t\t\tif (removedEntry) {\n\t\t\t\t\tremovedEntry.removeListener(\"changed\", this[\"_\" + _member + \"EntryChanged\"]);\n\t\t\t\t}\n\t\t\t};\n\t\t\tclassDef[\"_\" + _member + \"EntryChanged\"] = function(entry, entryMember, entryValue, oldEntryValue) {\n\t\t\t\tvar index = this[_member].indexOf(entry);\n\t\t\t\tif (index > -1) {\n\t\t\t\t\tthis.fireEvent(\"changed\", this, _member + \"[\" + index + \"].\" + entryMember, entryValue, oldEntryValue);\n\t\t\t\t}\n\t\t\t};\n\t\t} else if (!isComplexType && isCollection) {\n\t\t\tclassDef[\"_\" + _member + \"EntryInserted\"] = function(insertedEntry, index) {\n\t\t\t\t// maybe fire a change\n\t\t\t\tvar index = this[_member].indexOf(insertedEntry);\n\t\t\t\tif (index > -1) {\n\t\t\t\t\tthis.fireEvent(\"changed\", this, _member + \"[\" + index + \"]\", insertedEntry, undefined);\n\t\t\t\t}\n\t\t\t};\n\t\t\tclassDef[\"_\" + _member + \"EntryRemoved\"] = function(removedEntry, index) {\n\t\t\t\t// maybe fire a change\n\t\t\t\tvar index = this[_member].indexOf(removedEntry);\n\t\t\t\tif (index > -1) {\n\t\t\t\t\tthis.fireEvent(\"changed\", this, _member + \"[\" + index + \"]\", removedEntry, undefined);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\treturn function(_value, _silent) {\n\t\t\tvar old = this[_member];\n\n\t\t\tthis[_member] = _value;\n\t\t\tif (old !== _value) {\n\t\t\t\tif (isComplexType && !isCollection) {\n\t\t\t\t\tif (old) {\n\t\t\t\t\t\t// remove listener\n\t\t\t\t\t\told.removeListener(\"changed\", this[\"_\" + _member + \"Changed\"]);\n\t\t\t\t\t}\n\t\t\t\t\tif (_value) {\n\t\t\t\t\t\t// add listener\n\t\t\t\t\t\t_value.addListener(\"changed\", this[\"_\" + _member + \"Changed\"], this);\n\t\t\t\t\t}\n\t\t\t\t} else if (isCollection) {\n\t\t\t\t\tif (old) {\n\t\t\t\t\t\t// remove listeners from collection\n\t\t\t\t\t\told.removeListener(\"inserted\", this[\"_\" + _member + \"EntryInserted\"]);\n\t\t\t\t\t\told.removeListener(\"removed\", this[\"_\" + _member + \"EntryRemoved\"]);\n\n\t\t\t\t\t\tif (isComplexType) {\n\t\t\t\t\t\t\t// remove listeners from collection entries\n\t\t\t\t\t\t\told.each(function(entry) {\n\t\t\t\t\t\t\t\tentry.removeListener(\"changed\", this[\"_\" + _member + \"EntryChanged\"]);\n\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\tif (_value) {\n\t\t\t\t\t\t// remove listeners from collection\n\t\t\t\t\t\t_value.addListener(\"inserted\", this[\"_\" + _member + \"EntryInserted\"], this);\n\t\t\t\t\t\t_value.addListener(\"removed\", this[\"_\" + _member + \"EntryRemoved\"], this);\n\n\t\t\t\t\t\tif (isComplexType) {\n\t\t\t\t\t\t\t// remove listeners from collection entries\n\t\t\t\t\t\t\t_value.each(function(entry) {\n\t\t\t\t\t\t\t\tentry.addListener(\"changed\", this[\"_\" + _member + \"EntryChanged\"], this);\n\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!_silent) {\n\t\t\t\t\tif (typeof (this.fireEvent) === \"function\") {\n\t\t\t\t\t\tthis.fireEvent(\"changed\", this, _member, _value, old);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t},\n\tgetTypeByRootElement = function(rootElement) {\n\t\tvar modelName = typesByRootElement[rootElement];\n\t\tif (modelName) {\n\t\t\treturn cy[modelName];\n\t\t}\n\t\treturn undefined;\n\t},\n\tisSimpleBindingType = function(bindingType) {\n\t\treturn bindingType === \"Boolean\" || bindingType === \"Number\" || bindingType === \"String\" || bindingType === \"Date\";\n\t},\n\tgetFullType = function(typeName) {\n\t\tvar result = undefined;\n\t\tif (types[typeName].referenceType) {\n\t\t\tfor (var i in types[typeName].sub) {\n\t\t\t\tresult = getFullType(types[typeName].sub[i]);\n\t\t\t\tif (result) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tresult = typeName;\n\t\t}\n\t\treturn result;\n\t},\n\tgetReferenceType = function(typeName) {\n\t\tif (types[typeName].referenceType) {\n\t\t\treturn typeName;\n\t\t}\n\t\tif (types[typeName].parent) {\n\t\t\treturn getReferenceType(types[typeName].parent);\n\t\t}\n\t\treturn undefined;\n\t},\n\tfindLinkByRel = function(rel, rootResourceName) {\n\t\tvar tDef = types[rootResourceName];\n\t\tif (!tDef) {\n\t\t\tthrow new Error(\"unknown resource: \" + rootResourceName);\n\t\t}\n\t\treturn tDef[\"links\"][rel];\n\t},\n\tgetMemberWithType = function(typeName, memberTypeName) {\n\t\tfor (var member in types[typeName].members) {\n\t\t\tvar memberDescription = types[typeName].members[member];\n\t\t\tif (memberDescription.type === memberTypeName) {\n\t\t\t\treturn member;\n\t\t\t}\n\t\t}\n\t\tif (types[typeName].parent) {\n\t\t\treturn getMemberWithType(types[typeName].parent, memberTypeName);\n\t\t}\n\t\treturn undefined;\n\t},\n\taddMemberNamesToCollection = function(typeName, collection) {\n\t\tfor (var member in types[typeName][\"members\"]) {\n\t\t\tcollection.add(member);\n\t\t}\n\t\tif (types[typeName].parent) {\n\t\t\taddMemberNamesToCollection(types[typeName].parent, collection);\n\t\t}\n\t},\n\tgetMemberDeclaration = function(typeName, memberName) {\n\t\tvar type = types[typeName];\n\t\tif (type) {\n\t\t\tvar member = type.members[memberName];\n\t\t\tif (!member) {\n\t\t\t\tif (type.parent) {\n\t\t\t\t\treturn getMemberDeclaration(type.parent, memberName);\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn member;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t},\n\tgetMemberBindingForType = function(memberDescription, typeName) {\n\t\tfor (var binding in memberDescription[\"bindings\"]) {\n\t\t\tvar bindingType = memberDescription[\"bindings\"][binding];\n\t\t\tif (bindingType === typeName) {\n\t\t\t\treturn binding;\n\t\t\t}\n\t\t}\n\n\t\tvar parentTypeName = types[typeName][\"parent\"];\n\t\tif (parentTypeName) {\n\t\t\treturn getMemberBindingForType(memberDescription, parentTypeName);\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t},\n\tfindLinkInParentResource = function(config) {\n\t\tvar\n\t\t\trel = config.rel,\n\t\t\tconsumes = config.consumes,\n\t\t\tc = [],\n\t\t\tt,\n\t\t\ttDef,\n\t\t\ttRel\n\t\t;\n\t\tfor (t in types) {\n\t\t\ttDef = types[t];\n\t\t\tif (tDef[\"links\"]) {\n\t\t\t\tfor (tRel in tDef[\"links\"]) {\n\t\t\t\t\tif (tRel === rel) {\n\t\t\t\t\t\tif (tDef[\"links\"][tRel].consumes === consumes || !consumes) {\n\t\t\t\t\t\t\tc.push(t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn c;\n\t},\n\tfindLinkForPrimaryResource = function(primaryResourceName, rootResourceName) {\n\t\tvar tDef = types[rootResourceName];\n\t\tif (!tDef) {\n\t\t\tthrow new Error(\"unknown resource: \" + rootResourceName);\n\t\t}\n\t\tvar c = [];\n\t\tif (tDef[\"links\"]) {\n\t\t\tfor (var tRel in tDef[\"links\"]) {\n\t\t\t\tif (tDef[\"links\"][tRel].returns === primaryResourceName) {\n\t\t\t\t\tc.push(tRel);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn c;\n\t},\n\tgenerateModel = function(modelName) {\n\t\tvar\n\t\t\tclassDef = {\n\t\t\t\t// generate constructor\n\t\t\t\tconstruct: function(config) {\n\t\t\t\t\tif (arguments.callee.$parent.construct) {\n\t\t\t\t\t\tthis.callSuper(arguments, config);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tclazz: function() {\n\t\t\t\t\treturn cy[modelName];\n\t\t\t\t},\n\t\t\t\tclazzName: function() {\n\t\t\t\t\treturn modelName;\n\t\t\t\t},\n\t\t\t\tget: function(member) {\n\t\t\t\t\tvar m = upperCaseFirst(member);\n\t\t\t\t\tvar getterMethod = this[\"get\" + m];\n\t\t\t\t\tif (getterMethod) {\n\t\t\t\t\t\treturn this[\"get\" + m]();\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\t\t\t\tset: function(member, value, silent) {\n\t\t\t\t\tvar m = upperCaseFirst(member);\n\t\t\t\t\tvar setterMethod = this[\"set\" + m];\n\t\t\t\t\tif (setterMethod) {\n\t\t\t\t\t\tthis[\"set\" + m](value, silent);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfireEventForComplexMembers: function(eventName) {\n\t\t\t\t\tthis.members().each(function(member){\n\t\t\t\t\t\tvar \n\t\t\t\t\t\t\tmemberType = this.memberType(member),\n\t\t\t\t\t\t\tvalue;\n\t\t\t\t\t\t;\n\t\t\t\t\t\tif(!isSimpleTypeName(memberType)) {\n\t\t\t\t\t\t\tvalue = this.get(member);\n\t\t\t\t\t\t\tif(value) {\n\t\t\t\t\t\t\t\tif(this.memberIsCollection(member)) {\n\t\t\t\t\t\t\t\t\tvalue.each(function(child){\n\t\t\t\t\t\t\t\t\t\tchild.fireEvent(eventName, child);\n\t\t\t\t\t\t\t\t\t\tchild.fireEventForComplexMembers(eventName);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvalue.fireEvent(eventName, value);\n\t\t\t\t\t\t\t\t\tvalue.fireEventForComplexMembers(eventName);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\t\t\t\t},\n\t\t\t\tmembers: function() {\n\t\t\t\t\tvar tmp = new Collection();\n\t\t\t\t\taddMemberNamesToCollection(modelName, tmp);\n\t\t\t\t\treturn tmp;\n\t\t\t\t},\n\t\t\t\tmemberIsCollection: function(member) {\n\t\t\t\t\tvar declaration = getMemberDeclaration(modelName, member);\n\t\t\t\t\treturn declaration ? declaration.collection === true : false;\n\t\t\t\t},\n\t\t\t\tmemberType: function(member) {\n\t\t\t\t\tvar declaration = getMemberDeclaration(modelName, member);\n\t\t\t\t\treturn declaration ? declaration.type : undefined;\n\t\t\t\t},\n\t\t\t\tmemberIsComplex: function(member) {\n\t\t\t\t\tvar declaration = getMemberDeclaration(modelName, member);\n\t\t\t\t\treturn declaration ? declaration.type : undefined;\n\t\t\t\t},\n\t\t\t\textends: function(parentTypeName) {\n\t\t\t\t\tif (parentTypeName === modelName) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar curModel = modelDefinition;\n\t\t\t\t\t\twhile (curModel !== null && curModel !== undefined) {\n\t\t\t\t\t\t\tif (curModel.parent === parentTypeName) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcurModel = types[curModel.parent];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tasynchronous execution. returns a promise.\n\t\t\t\t*/\n\t\t\t\treload: function(silent) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\tthat.follow({rel: \"self\"}).then(function(_self){\n\t\t\t\t\t\t\tvar data = {};\n\t\t\t\t\t\t\t_self.serialize(data);\n\t\t\t\t\t\t\tthat.loadData(data, silent);\n\t\t\t\t\t\t\tresolve(that);\n\t\t\t\t\t\t\tthat.fireEvent(\"reloaded\", that);\n\t\t\t\t\t\t}).catch(function(_error){\n\t\t\t\t\t\t\treject(_error);\n\t\t\t\t\t\t\tthat.fireEvent(\"reloadFailed\", that, _error);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tasynchronous execution. returns a promise.\n\t\t\t\t*/\n\t\t\t\tfind: function() {\n\t\t\t\t\tvar _t = this;\n\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\tfollowPrimaryResourceLink(\"find\", _t)\n\t\t\t\t\t\t.then(function(url) {\n\t\t\t\t\t\t\tif (!url) {\n\t\t\t\t\t\t\t\treject(_t);\n\t\t\t\t\t\t\t\t_t.fireEvent(\"notFound\", _t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif(typeof(url) !== \"string\") {\n\t\t\t\t\t\t\t\t\tif(url.clazzName() === _t.clazzName()) {\n\t\t\t\t\t\t\t\t\t\tvar selfLink = url.hasLink(\"self\");\n\t\t\t\t\t\t\t\t\t\tif(selfLink) {\n\t\t\t\t\t\t\t\t\t\t\turl = selfLink.getHref();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\treject(_t);\n\t\t\t\t\t\t\t\t\t\t\t_t.fireEvent(\"notFound\", _t);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\treject(_t);\n\t\t\t\t\t\t\t\t\t\t_t.fireEvent(\"notFound\", _t);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_t.setLink(\"self\", url, \"GET\");\n\t\t\t\t\t\t\t\t_t.reload().then(function(reloaded){\n\t\t\t\t\t\t\t\t\tresolve(reloaded);\n\t\t\t\t\t\t\t\t}).catch(function(error) {\n\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t_t.fireEvent(\"found\", _t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(function(_error) {\n\t\t\t\t\t\t\t_t.fireEvent(\"notFound\", _t);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tasynchronous execution. returns a promise.\n\t\t\t\t*/\n\t\t\t\tfindAll: function() {\n\t\t\t\t\tvar _t = this;\n\t\t\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\t\t\tconsole.log(\"find all for \"+modelName);\n\t\t\t\t\t\tfollowPrimaryResourceLink(\"findAll\", _t)\n\t\t\t\t\t\t.then(function(url) {\n\t\t\t\t\t\t\tif(typeof(url) === \"string\") {\n\t\t\t\t\t\t\t\t_t.follow({\n\t\t\t\t\t\t\t\t\turl: url\n\t\t\t\t\t\t\t\t}).then(function(page){\n\t\t\t\t\t\t\t\t\tresolve(page);\n\t\t\t\t\t\t\t\t\t_t.fireEvent(\"foundSimilar\", _t, page);\n\t\t\t\t\t\t\t\t}).catch(function(error){\n\t\t\t\t\t\t\t\t\treject(error)\n\t\t\t\t\t\t\t\t\t_t.fireEvent(\"noSimilarFound\", _t);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else if(url instanceof cy[\"AtomLink\"]) {\n\t\t\t\t\t\t\t\t_t.follow({\n\t\t\t\t\t\t\t\t\tlink: url\n\t\t\t\t\t\t\t\t}).then(function(page){\n\t\t\t\t\t\t\t\t\tresolve(page);\n\t\t\t\t\t\t\t\t\t_t.fireEvent(\"foundSimilar\", _t, page);\n\t\t\t\t\t\t\t\t}).catch(function(error){\n\t\t\t\t\t\t\t\t\treject(error)\n\t\t\t\t\t\t\t\t\t_t.fireEvent(\"noSimilarFound\", _t);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(url);\n\t\t\t\t\t\t\t\t_t.fireEvent(\"foundSimilar\", _t, url);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(function(_error) {\n\t\t\t\t\t\t\treject(_error);\n\t\t\t\t\t\t\t_t.fireEvent(\"notFound\", _t);\n\t\t\t\t\t\t\t_t.fireEvent(\"noSimilarFound\", _t);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tfollowPrimaryResourceLink: function(config) {\n\t\t\t\t\tfollowPrimaryResourceLink(config.rel, config.payload, config.purpose);\n\t\t\t\t},\n\t\t\t\tprimaryResource: function(config, purpose) {\n\t\t\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\t\t\tconsole.log(\"do stuff with primary resource\");\n\t\t\t\t\t\tvar\n\t\t\t\t\t\t\tlink,\n\t\t\t\t\t\t\tft,\n\t\t\t\t\t\t\tlinksToParent\n\t\t\t\t\t\t;\n\t\t\t\t\t\tif (modelDefinition.referenceType) {\n\t\t\t\t\t\t\tft = getFullType(modelName);\n\t\t\t\t\t\t\tif (!ft) {\n\t\t\t\t\t\t\t\treject(\"could not find full type for \" + modelName);\n\t\t\t\t\t\t\t\tconsole.warn(\"could not find full type for \" + modelName);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlink = findLinkByRel(\"list\", ft);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlink = findLinkByRel(\"list\", modelName);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (link) {\n\t\t\t\t\t\t\tif (link.returns) {\n\t\t\t\t\t\t\t\tlinksToParent = findLinkForPrimaryResource(link.returns, cy.root.clazzName());\n\t\t\t\t\t\t\t\tif (linksToParent.length === 1) {\n\t\t\t\t\t\t\t\t\tcy.initPromise.then(function(services){\n\t\t\t\t\t\t\t\t\t\tservices.follow({\n\t\t\t\t\t\t\t\t\t\t\trel: linksToParent[0]\n\t\t\t\t\t\t\t\t\t\t}).then(function(result) {\n\t\t\t\t\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t\t\t\t\t}).catch(function(error){\n\t\t\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}).catch(function(){\n\t\t\t\t\t\t\t\t\t\treject(\"root resource was not loaded properly\");\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// it could be a generated model from a schema.\n\t\t\t\t\t\t\t\t\tconfig.noLink = function(){\n\t\t\t\t\t\t\t\t\t\tconsole.warn(\"could find primary resource to \" + modelName + \" and the return type, but there was no unique link from the primary resource to the return type.\");\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tconsole.log(\"trying to access primary resource for \"+modelName);\n\t\t\t\t\t\t\t\t\ttryWithSchema(config, purpose).then(function(result){\n\t\t\t\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t\t\t\t}).catch(function(error) {\n\t\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treject(\"could find primary resource to \" + modelName + \" but the link did not provide a return type\");\n\t\t\t\t\t\t\t\tconsole.warn(\"could find primary resource to \" + modelName + \" but the link did not provide a return type\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(\"could not find primary resource to \" + modelName);\n\t\t\t\t\t\t\tconsole.warn(\"could not find primary resource to \" + modelName);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tpersistDelayedAndReload: function(fn, silent) {\n\t\t\t\t\tfn(this, this.createPersistCallback(true, silent));\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tasynchronous execution. returns a promise.\n\t\t\t\t*/\n\t\t\t\tpersistAndReload: function(silent) {\n\t\t\t\t\treturn this._persist(true, silent);\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tasynchronous execution. returns a promise.\n\t\t\t\t*/\n\t\t\t\tpersist: function(silent) {\n\t\t\t\t\treturn this._persist(false, silent);\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution. returns a function, that will create a promise.\n\t\t\t\t*/\n\t\t\t\tcreatePersistCallback: function(reload, silent) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\treturn function() {\n\t\t\t\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\t\t\t\tvar updateLink = that.hasLink(\"update\");\n\t\t\t\t\t\t\tif (updateLink) {\n\t\t\t\t\t\t\t\tthat.follow({\n\t\t\t\t\t\t\t\t\tpayload: that,\n\t\t\t\t\t\t\t\t\tlink: updateLink\n\t\t\t\t\t\t\t\t}).then(function(){\n\t\t\t\t\t\t\t\t\tif (reload) {\n\t\t\t\t\t\t\t\t\t\tthat.fireEvent(\"persisted\", that);\n\t\t\t\t\t\t\t\t\t\tthat.fireEventForComplexMembers(\"persisted\");\n\t\t\t\t\t\t\t\t\t\tthat.reload().then(function(){\n\t\t\t\t\t\t\t\t\t\t\tresolve(that);\n\t\t\t\t\t\t\t\t\t\t}).catch(function(_error){\n\t\t\t\t\t\t\t\t\t\t\treject(that, _error)\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tresolve(that);\n\t\t\t\t\t\t\t\t\t\tthat.fireEvent(\"persisted\", that);\n\t\t\t\t\t\t\t\t\t\tthat.fireEventForComplexMembers(\"persisted\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}).catch(function(_error){\n\t\t\t\t\t\t\t\t\treject(that, _error);\n\t\t\t\t\t\t\t\t\tthat.fireEvent(\"persistenceFailed\", that, _error);\n\t\t\t\t\t\t\t\t\tthat.fireEventForComplexMembers(\"persistenceFailed\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// create\n\t\t\t\t\t\t\t\tfollowPrimaryResourceLink(\"add\", that)\n\t\t\t\t\t\t\t\t.then(function(url) {\n\t\t\t\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t\t\t\tthat.setLink(\"self\", url, \"GET\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (reload) {\n\t\t\t\t\t\t\t\t\t\tthat.fireEvent(\"persisted\", that);\n\t\t\t\t\t\t\t\t\t\tthat.fireEventForComplexMembers(\"persisted\");\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"reloading after persist\")\n\t\t\t\t\t\t\t\t\t\tthat.reload().then(function(){\n\t\t\t\t\t\t\t\t\t\t\tresolve(that);\n\t\t\t\t\t\t\t\t\t\t}).catch(function(_error){\n\t\t\t\t\t\t\t\t\t\t\treject(that, _error)\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tresolve(that);\n\t\t\t\t\t\t\t\t\t\tthat.fireEvent(\"persisted\", that);\n\t\t\t\t\t\t\t\t\t\tthat.fireEventForComplexMembers(\"persisted\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.catch(function(_error) {\n\t\t\t\t\t\t\t\t\treject(that, _error);\n\t\t\t\t\t\t\t\t\tthat.fireEvent(\"persistenceFailed\", that, _error);\n\t\t\t\t\t\t\t\t\tthat.fireEventForComplexMembers(\"persistenceFailed\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tasynchronous execution. returns a promise.\n\t\t\t\t*/\n\t\t\t\t_persist: function(reload, silent) {\n\t\t\t\t\treturn this.createPersistCallback(reload, silent)();\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tasynchronous execution. returns a promise.\n\t\t\t\t*/\n\t\t\t\tremove: function(silent) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\t\t\tthat.follow({ rel: \"remove\" }).then(function(){\n\t\t\t\t\t\t\tresolve(that);\n\t\t\t\t\t\t\tthat.fireEvent(\"removed\", that);\n\t\t\t\t\t\t}).catch(function(_error){\n\t\t\t\t\t\t\treject(_error);\n\t\t\t\t\t\t\tthat.fireEvent(\"removeFailed\", that, _error);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\thasLink: function(rel) {\n\t\t\t\t\tvar member = getMemberWithType(modelName, \"AtomLink\");\n\t\t\t\t\tvar result = undefined;\n\t\t\t\t\tif (member) {\n\t\t\t\t\t\tvar v = this.get(member);\n\t\t\t\t\t\tif (v !== undefined) {\n\t\t\t\t\t\t\tv.each(function(item, index) {\n\t\t\t\t\t\t\t\tif (item.getRel() === rel) {\n\t\t\t\t\t\t\t\t\tresult = item;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tasynchronous execution. returns a promise.\n\t\t\t\t*/\n\t\t\t\tfollow: function(config) {\n\t\t\t\t\tvar that = this;\n\t\t\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\t\t\tvar rel = config.rel,\n\t\t\t\t\t\t\t\tcb = config.cb,\n\t\t\t\t\t\t\t\tscope = config.scope,\n\t\t\t\t\t\t\t\titem = config.link,\n\t\t\t\t\t\t\t\tfcb = config.fcb,\n\t\t\t\t\t\t\t\tpayload = config.payload,\n\t\t\t\t\t\t\t\turl = config.url;\n\t\t\t\t\t\tif (!item) {\n\t\t\t\t\t\t\tif (!rel) {\n\t\t\t\t\t\t\t\tif (!url) {\n\t\t\t\t\t\t\t\t\treject(\"provide a link or rel when calling 'follow'\");\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\titem = new cy.AtomLink();\n\t\t\t\t\t\t\t\t\titem.setHref(url);\n\t\t\t\t\t\t\t\t\titem.setMethod(\"GET\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\titem = that.hasLink(rel);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (item) {\n\t\t\t\t\t\t\tvar t = that;\n\t\t\t\t\t\t\tvar dataToSend = undefined;\n\t\t\t\t\t\t\tvar headers = {};\n\t\t\t\t\t\t\tif (payload) {\n\t\t\t\t\t\t\t\tif (payload.wrappedSerialize && typeof (payload.wrappedSerialize) === \"function\") {\n\t\t\t\t\t\t\t\t\tdataToSend = {};\n\t\t\t\t\t\t\t\t\tpayload.wrappedSerialize(dataToSend);\n\t\t\t\t\t\t\t\t\tdataToSend = JSON.stringify(dataToSend);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdataToSend = payload;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\theaders[\"Content-Type\"] = \"application/json\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar url = item.getHref();\n\t\t\t\t\t\t\tif(typeof(url) !== \"string\") {\n\t\t\t\t\t\t\t\treject(\"can not load url, because it isn't a string\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\theaders: headers,\n\t\t\t\t\t\t\t\txhrFields: {\n\t\t\t\t\t\t\t\t\twithCredentials: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbeforeSend: function(xhr){\n\t\t\t\t\t\t\t\t\txhr.setRequestHeader(\"Accept\", \"application/json\");\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: item.getMethod(),\n\t\t\t\t\t\t\t\tdata: dataToSend,\n\t\t\t\t\t\t\t\tcomplete: function(xhr, code) {\n\t\t\t\t\t\t\t\t\tvar\n\t\t\t\t\t\t\t\t\t\tisFailure = xhr.status >= 400,\n\t\t\t\t\t\t\t\t\t\tcallbackToCall\n\t\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\t\tif (xhr.status === 0) {\n\t\t\t\t\t\t\t\t\t\treject(\"no status in response for \"+url+ \" via \"+item.getMethod());\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcallbackToCall = isFailure && fcb ? fcb : cb;\n\n\t\t\t\t\t\t\t\t\t\tvar elements = [];\n\t\t\t\t\t\t\t\t\t\tif (xhr.status !== 204) {\n\t\t\t\t\t\t\t\t\t\t\tvar loc = xhr.getResponseHeader(\"Location\");\n\t\t\t\t\t\t\t\t\t\t\tif (xhr.getResponseHeader(\"Content-Type\") === \"application/json\") {\n\t\t\t\t\t\t\t\t\t\t\t\tif (xhr.responseText) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar payload = $.parseJSON(xhr.responseText);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var element in payload) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// get the according type\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar elementType = getTypeByRootElement(element);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (elementType) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// loadPayload\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar instance = new elementType();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinstance.loadData(payload[element]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telements.push(instance);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} else if (loc) {\n\t\t\t\t\t\t\t\t\t\t\t\telements.push(loc);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t// firefox jquery hack\n\t\t\t\t\t\t\t\t\t\t\t\tif (xhr.responseText) {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar payload = $.parseJSON(xhr.responseText);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var element in payload) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// get the according type\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar elementType = getTypeByRootElement(element);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (elementType) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// loadPayload\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar instance = new elementType();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinstance.loadData(payload[element]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telements.push(instance);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif(isFailure) {\n\t\t\t\t\t\t\t\t\t\t\treject.apply(scope, elements);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tresolve.apply(scope, elements);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t// invoke callback\n\t\t\t\t\t\t\t\t\t\tif (typeof (callbackToCall) === \"function\") {\n\t\t\t\t\t\t\t\t\t\t\tif (!scope) {\n\t\t\t\t\t\t\t\t\t\t\t\tscope = t;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tcallbackToCall.apply(scope, elements);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(\"no link or url defined to load\");\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\tsetLink: function(rel, url, method) {\n\t\t\t\t\tvar member = getMemberWithType(modelName, \"AtomLink\");\n\t\t\t\t\tif (member) {\n\t\t\t\t\t\tvar v = this.get(member);\n\t\t\t\t\t\tif (v === undefined || v === null) {\n\t\t\t\t\t\t\tv = new Collection();\n\t\t\t\t\t\t\tthis.set(member, v, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar found = null;\n\t\t\t\t\t\tv.each(function(item, index) {\n\t\t\t\t\t\t\tif (item.getRel() === rel) {\n\t\t\t\t\t\t\t\tfound = item;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this);\n\t\t\t\t\t\tif (!found) {\n\t\t\t\t\t\t\tfound = new cy.AtomLink();\n\t\t\t\t\t\t\tv.add(found);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfound.setRel(rel);\n\t\t\t\t\t\tfound.setHref(url);\n\t\t\t\t\t\tif (!method) {\n\t\t\t\t\t\t\tmethod = \"GET\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfound.setMethod(method);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\tsub: function() {\n\t\t\t\t\treturn modelDefinition.sub;\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\tdeRef: function() {\n\t\t\t\t\tvar fullType = getFullType(modelName);\n\t\t\t\t\tif (fullType) {\n\t\t\t\t\t\tvar full = new cy[fullType]();\n\t\t\t\t\t\tvar tmp = {};\n\t\t\t\t\t\tthis.serialize(tmp);\n\t\t\t\t\t\tfull.loadData(tmp, true);\n\t\t\t\t\t\treturn full;\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\trefType: function(){\n\t\t\t\t\tvar refType = getReferenceType(modelName);\n\t\t\t\t\treturn cy[refType];\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\tref: function() {\n\t\t\t\t\tvar refType = getReferenceType(modelName);\n\t\t\t\t\tif (refType) {\n\t\t\t\t\t\tvar ref = new cy[refType]();\n\t\t\t\t\t\tvar tmp = {};\n\t\t\t\t\t\tthis.serialize(tmp);\n\t\t\t\t\t\tref.loadData(tmp, true);\n\t\t\t\t\t\treturn ref;\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\tloadPayload: function(payload, silent) {\n\t\t\t\t\tif (modelDefinition.rootElement) {\n\t\t\t\t\t\tvar data = payload[modelDefinition.rootElement];\n\t\t\t\t\t\tthis.loadData(data, silent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(\"can't load payload for \" + modelName + \" because no rootElement is defined.\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\tloadData: function(data, silent) {\n\t\t\t\t\tif (data !== undefined) {\n\t\t\t\t\t\tfor (var member in modelDefinition[\"members\"]) {\n\t\t\t\t\t\t\tvar memberDescription = modelDefinition[\"members\"][member];\n\t\t\t\t\t\t\tvar isCollection = memberDescription.collection;\n\t\t\t\t\t\t\tvar c;\n\t\t\t\t\t\t\tif (isCollection) {\n\t\t\t\t\t\t\t\tc = new Collection();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (var binding in memberDescription[\"bindings\"]) {\n\t\t\t\t\t\t\t\tvar bindingType = memberDescription[\"bindings\"][binding];\n\t\t\t\t\t\t\t\tvar isSimple = isSimpleBindingType(bindingType);\n\t\t\t\t\t\t\t\tif (!isSimple) {\n\t\t\t\t\t\t\t\t\tif (isCollection) {\n\t\t\t\t\t\t\t\t\t\tvar a = data[binding];\n\t\t\t\t\t\t\t\t\t\tif (!(a instanceof Array)) {\n\t\t\t\t\t\t\t\t\t\t\ta = [a];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tfor (var tmp in a) {\n\t\t\t\t\t\t\t\t\t\t\tif (a[tmp] !== undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(cy[bindingType]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar v = new cy[bindingType]();\n\t\t\t\t\t\t\t\t\t\t\t\t\tv.loadData(a[tmp], silent);\n\t\t\t\t\t\t\t\t\t\t\t\t\tc.add(v);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.warn(\"could not find constructor for \"+bindingType);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (data[binding] !== undefined) {\n\t\t\t\t\t\t\t\t\t\t\tvar v = new cy[bindingType]();\n\t\t\t\t\t\t\t\t\t\t\tv.loadData(data[binding], silent);\n\t\t\t\t\t\t\t\t\t\t\tthis.set(member, v, silent);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (isCollection) {\n\t\t\t\t\t\t\t\t\t\tvar a = data[binding];\n\t\t\t\t\t\t\t\t\t\tif (!(a instanceof Array)) {\n\t\t\t\t\t\t\t\t\t\t\ta = [a];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tfor (var tmp in a) {\n\t\t\t\t\t\t\t\t\t\t\tvar v = a[tmp];\n\t\t\t\t\t\t\t\t\t\t\tif (v !== undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (bindingType === \"Date\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\tv = new Date(v);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tc.add(v);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tvar v = data[binding];\n\t\t\t\t\t\t\t\t\t\tif (v !== undefined) {\n\t\t\t\t\t\t\t\t\t\t\tif (bindingType === \"Date\") {\n\t\t\t\t\t\t\t\t\t\t\t\tv = new Date(v);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tthis.set(member, v, silent);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (isCollection) {\n\t\t\t\t\t\t\t\tthis.set(member, c, silent);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (arguments.callee.$parent.loadData) {\n\t\t\t\t\t\targuments.callee.$parent.loadData.call(this, data, silent);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\twrappedSerialize: function(data) {\n\t\t\t\t\tvar rootElementName = modelDefinition[\"rootElement\"];\n\t\t\t\t\tif (rootElementName) {\n\t\t\t\t\t\tdata[rootElementName] = {};\n\t\t\t\t\t\tthis.serialize(data[rootElementName]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"can't execute wrapped serialize on \" + modelName);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\tsynchronous execution\n\t\t\t\t*/\n\t\t\t\tserialize: function(data) {\n\t\t\t\t\tfor (var member in modelDefinition[\"members\"]) {\n\t\t\t\t\t\tvar memberDescription = modelDefinition[\"members\"][member];\n\t\t\t\t\t\tvar value = this.get(member);\n\t\t\t\t\t\tif (value !== null && value !== undefined) {\n\t\t\t\t\t\t\tvar typeOfMember = cy[memberDescription[\"type\"]];\n\t\t\t\t\t\t\tvar isCollection = memberDescription.collection;\n\n\t\t\t\t\t\t\t// complex type\n\t\t\t\t\t\t\tif (typeOfMember) {\n\t\t\t\t\t\t\t\tif (isCollection) {\n\t\t\t\t\t\t\t\t\tvalue.each(function(item, index) {\n\t\t\t\t\t\t\t\t\t\tvar binding = getMemberBindingForType(memberDescription, item.clazzName());\n\t\t\t\t\t\t\t\t\t\tif (binding) {\n\t\t\t\t\t\t\t\t\t\t\tif (data[binding] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\tdata[binding] = [];\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tvar tmp = {};\n\t\t\t\t\t\t\t\t\t\t\titem.serialize(tmp);\n\t\t\t\t\t\t\t\t\t\t\tdata[binding].push(tmp);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// find the binding to use\n\t\t\t\t\t\t\t\t\tvar binding = getMemberBindingForType(memberDescription, value.clazzName());\n\t\t\t\t\t\t\t\t\tif (binding) {\n\t\t\t\t\t\t\t\t\t\tdata[binding] = {};\n\t\t\t\t\t\t\t\t\t\tvalue.serialize(data[binding]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\t\t// simple type\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (isCollection) {\n\t\t\t\t\t\t\t\t\tvalue.each(function(item, index) {\n\t\t\t\t\t\t\t\t\t\tfor (var binding in memberDescription[\"bindings\"]) {\n\t\t\t\t\t\t\t\t\t\t\tvar bindingType = memberDescription[\"bindings\"][binding];\n\t\t\t\t\t\t\t\t\t\t\tif (isSimpleBindingType(bindingType)) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (data[binding] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata[binding] = [];\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tdata[binding].push(item);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfor (var binding in memberDescription[\"bindings\"]) {\n\t\t\t\t\t\t\t\t\t\tvar bindingType = memberDescription[\"bindings\"][binding];\n\t\t\t\t\t\t\t\t\t\tif (isSimpleBindingType(bindingType)) {\n\t\t\t\t\t\t\t\t\t\t\tdata[binding] = value;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (arguments.callee.$parent.serialize) {\n\t\t\t\t\t\targuments.callee.$parent.serialize.call(this, data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tmodelDefinition = types[modelName],\n\t\t\tmember,\n\t\t\tmemberDef,\n\t\t\tm,\n\t\t\tm2,\n\t\t\tmemberType,\n\t\t\tisCollection,\n\t\t\tisSimpleType,\n\t\t\tfollowPrimaryResourceLink = function(rel, payload, purpose) {\n\t\t\t\tvar that = this;\n\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\tconsole.log(\"following primary resource link\");\n\t\t\t\t\tvar\n\t\t\t\t\t\tparents = findLinkInParentResource({\n\t\t\t\t\t\t\trel: rel,\n\t\t\t\t\t\t\tconsumes: modelName\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tp,\n\t\t\t\t\t\tlinksToParent,\n\t\t\t\t\t\tprimaryResourceCallback = primaryResourceCallback = function(_p) {\n\t\t\t\t\t\t\tconsole.log(\"handling primary resource \"+modelName);\n\t\t\t\t\t\t\t_p.follow({\n\t\t\t\t\t\t\t\trel: rel,\n\t\t\t\t\t\t\t\tpayload: payload\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(function(result){\n\t\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(function(error){\n\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t;\n\t\t\t\t\tif (parents.length === 1) {\n\t\t\t\t\t\t// there is only one type, that consumes the current model (modelName) via the provided rel.\n\t\t\t\t\t\tp = parents[0];\n\t\t\t\t\t\t// then we have to figure out, how we can GET to the instance of the type, that offers the link with the defined rel.\n\t\t\t\t\t\tlinksToParent = findLinkForPrimaryResource(p, cy.root.clazzName());\n\t\t\t\t\t\t// if there is exactly one intermediate link via the root resource, then we will load the type instance by following the intermediate link.\n\t\t\t\t\t\tif (linksToParent.length === 1) {\n\t\t\t\t\t\t\tcy.initPromise\n\t\t\t\t\t\t\t.then(function(services){\n\t\t\t\t\t\t\t\tservices.follow({\n\t\t\t\t\t\t\t\t\trel: linksToParent[0]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then(primaryResourceCallback)\n\t\t\t\t\t\t\t\t.catch(function(){\n\t\t\t\t\t\t\t\t\treject(\"could not follow root resource\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(function(){\n\t\t\t\t\t\t\t\treject(\"root resource could not be loaded\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (linksToParent.length === 0) {\n\t\t\t\t\t\t\t// if there is no link in the root resource, then we can still try by looking at the deployed schemas.\n\t\t\t\t\t\t\ttryWithSchema({}, purpose)\n\t\t\t\t\t\t\t.then(primaryResourceCallback)\n\t\t\t\t\t\t\t.catch(function(){\n\t\t\t\t\t\t\t\treject(\"no way found to get to \" + p + \" from the root resource.\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(\"no unique way found to get to \" + p + \" from the root resource.\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (parents.length === 0) {\n\t\t\t\t\t\treject(\"no parent found where \" + modelName + \" could be sent to via '\" + rel + \"'.\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(\"multiple parents found where \" + modelName + \" could be sent to via '\" + rel + \"': \" + parents);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t},\n\t\t\t/*\n\t\t\tasynchronous execution. returns a promise. then() will be called with the loaded primary resource of the outer modelName.\n\t\t\tthis function only works for entities, that are defined in a schema. this function will not work for messages, that are manually implemented.\n\t\t\t*/\n\t\t\ttryWithSchema = function(config, purpose) {\n\t\t\t\tif(!purpose) {\n\t\t\t\t\tconsole.log(\"missing purpose info\");\n\t\t\t\t}\n\t\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\t\tgetSchemaPromise().then(function(schemaInfo){\n\t\t\t\t\t\tfor(var schemaName in schemaInfo) {\n\t\t\t\t\t\t\tif(typeof(schemaName) === \"string\") {\n\t\t\t\t\t\t\t\tvar schema = schemaInfo[schemaName];\n\t\t\t\t\t\t\t\tvar patchedModelName = modelName;\n\t\t\t\t\t\t\t\tvar i = patchedModelName.indexOf(\"RestBean\");\n\t\t\t\t\t\t\t\tvar j = patchedModelName.indexOf(\"ReferenceRestBean\");\n\t\t\t\t\t\t\t\tvar k = patchedModelName.indexOf(\"ListRestBean\");\n\t\t\t\t\t\t\t\tif(i > -1) {\n\t\t\t\t\t\t\t\t\tpatchedModelName = patchedModelName.substr(0,i);\n\t\t\t\t\t\t\t\t} else if(j > -1) {\n\t\t\t\t\t\t\t\t\tpatchedModelName = patchedModelName.substr(0,j);\n\t\t\t\t\t\t\t\t} else if(k > -1) {\n\t\t\t\t\t\t\t\t\tpatchedModelName = patchedModelName.substr(0,k);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(schema[patchedModelName]) {\n\t\t\t\t\t\t\t\t\tschema[patchedModelName].type.follow({ rel: \"primaryResource\" })\n\t\t\t\t\t\t\t\t\t.then(function(pr){\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"did load primary resource \"+modelName+\" \"+purpose);\n\t\t\t\t\t\t\t\t\t\tresolve(pr);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch(function(pr){\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"did not load primary resource\");\n\t\t\t\t\t\t\t\t\t\treject(pr);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treject(\"could not find link\");\n\t\t\t\t\t\tconsole.log(\"could not find link\");\n\t\t\t\t\t}).catch(function(){\n\t\t\t\t\t\treject(\"could not find link\");\n\t\t\t\t\t\tconsole.log(\"could not find link\");\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tparent = modelDefinition.parent,\n\t\t\tparentClass;\n\t\t;\n\n\t\tif (!modelDefinition) {\n\t\t\tthrow new Error(\"unknown model: \" + modelName);\n\t\t}\n\n\t\tif (modelDefinition.rootElement) {\n\t\t\ttypesByRootElement[modelDefinition.rootElement] = modelName;\n\t\t}\n\n\t\t// generate getter and setter\n\t\tfor (member in modelDefinition[\"members\"]) {\n\t\t\tmemberDef = modelDefinition[\"members\"][member];\n\t\t\tm = member;\n\t\t\tm2 = upperCaseFirst(member);\n\t\t\tmemberType = memberDef.type;\n\t\t\tisCollection = memberDef.collection;\n\t\t\tisSimpleType = isSimpleTypeName(memberType);\n\t\t\tclassDef[\"get\" + m2] = createGetter(m);\n\t\t\tclassDef[\"set\" + m2] = createSetter(m, !isSimpleType, isCollection, classDef);\n\t\t}\n\n\t\t// generate parent type to extend\n\t\tif (parent) {\n\t\t\tif (cy[parent] === undefined) {\n\t\t\t\tgenerateModel(parent);\n\t\t\t}\n\t\t\tparentClass = cy[parent];\n\t\t} else {\n\t\t\tparentClass = Observable;\n\t\t}\n\n\t\tcy[modelName] = parentClass.extend(classDef);\n\t}\n;\n\ncy.getFullType = getFullType;\n\nfor (var type in types) {\n\tif (cy[type] === undefined) {\n\t\tgenerateModel(type);\n\t}\n}\n\n// load the root resource in order to get access to all primary resources such as carts, orders etc.\nservices = new cy.Services();\nservices.setLink(\"self\", entry);\ncy.root = services;\ncy.initPromise = services.reload().then(function(loadedServices){\n\tconsole.log(\"services are now loaded.\");\n\treturn loadedServices;\n});\n\nreturn cy;\n","initMethod@STRING":"","dependencies@STRING":["/libs/bndly/data/scripts/cy/communicationDescription","/libs/bndly/data/scripts/cy/Observable","/libs/bndly/data/scripts/cy/StringUtil","/libs/bndly/data/scripts/cy/Collection","/libs/vendor/jquery"],"proxy@STRING":"","moduleId@STRING":"","export@STRING":""}}
