{"type":"cy:bean","properties":{"beanType@STRING":"cy:requiremodule","name@STRING":"DropZone","dependencies@STRING":["/libs/bndly/data/scripts/cy/ui/input/InputViewComponent","/libs/bndly/data/scripts/cy/ui/input/InputTypeRegistry","/libs/bndly/data/scripts/cy/ProgressBar"],"script@STRING":"var DropZone = InputViewComponent.extend({\r\n\tconstruct: function(config) {\r\n\t\tif (!config) {\r\n\t\t\tconfig = {};\r\n\t\t}\r\n\t\tconfig.progressBar = new ProgressBar({hidden: true});\r\n\t\tthis.callSuper(arguments, config);\r\n\t},\r\n\tdestroy: function() {\r\n\t\tthis.progressBar.destroy();\r\n\t\tthis.invokeSuper(arguments);\r\n\t},\r\n\trenderTo: function(renderTarget) {\r\n\t\tthis.element = $(renderTarget).append(\"<div class=\\\"well well-small dropZone\\\"><i class=\\\"icon-plus-sign\\\"></i> upload new data</div>\").children().last();\r\n\t\tvar el = this.element[0],\r\n\t\t\t_this = this;\r\n\t\tel.ondragover = function() {\r\n\t\t\t_this.onDragOver();\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tel.ondragend = function() {\r\n\t\t\t_this.onDragEnd();\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tel.ondrop = function(e) {\r\n\t\t\t_this.onDrop(e);\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tthis.progressBar.renderTo(renderTarget);\r\n\t},\r\n\tonDragOver: function() {\r\n\r\n\t},\r\n\tonDragEnd: function() {\r\n\r\n\t},\r\n\tonDrop: function(e) {\r\n\t\te.preventDefault();\r\n\r\n\t\tthis.progressBar.setPercent(0);\r\n\t\tthis.progressBar.show();\r\n\t\tvar file = e.dataTransfer.files[0],\r\n\t\tpb = this.progressBar;\r\n\t\tpb.none();\r\n\t\tpb.show();\r\n\t\t$.ajax({\r\n\t\t\turl: this.uploadLocation+file.name,\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: file,\r\n\t\t\tprocessData: false,\r\n\t\t\theaders: {\r\n\t\t\t\t\"Content-Type\": file.type\r\n\t\t\t},\r\n\t\t\txhr: function() {\r\n\t\t\t\tvar xhr = $.ajaxSettings.xhr();\r\n\t\t\t\txhr.upload.addEventListener(\"progress\", function(evt){\r\n\t\t\t\t\tpb.setPercent((evt.loaded*100)/evt.total);\r\n\t\t\t\t\tpb.none(parseInt(pb.percent)+\"% completed\");\r\n\t\t\t\t}, false);\r\n\t\t\t\txhr.upload.addEventListener(\"load\", function(evt) {\r\n\t\t\t\t\tpb.success(\"upload complete\");\r\n\t\t\t\t}, false);\r\n\t\t\t\txhr.upload.addEventListener(\"error\", function(evt) {\r\n\t\t\t\t\tpb.error(\"upload failed\");\r\n\t\t\t\t}, false);\r\n\t\t\t\txhr.upload.addEventListener(\"abort\", function(evt) {\r\n\t\t\t\t\tpb.warn(\"upload cancelled\");\r\n\t\t\t\t}, false);\r\n\t\t\t\treturn xhr;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tgetValue: function() {\r\n\t\treturn undefined;\r\n\t},\r\n\tsetValue: function(value) {}\r\n});\r\nInputTypeRegistry.register(\"DropZone\", DropZone);\r\nreturn DropZone;","initMethod@STRING":"","proxy@STRING":"","moduleId@STRING":""}}
